# 5.3 인터넷에서의 AS 내부 라우팅: OSPF

네트워크를 **동일한 라우팅 알고리즘을 수행하는 동종의 라우터 집합**으로 간주하는 관점은 다음의 두 가지 문제점이 존재한다.

1. `확장`

   라우터의 수가 증가함에 따라 라우팅 정보의 통신, 계산, 저장에 필요한 오버헤드가 걷잡을 수 없이 증가한다.


3. `관리 자율성`

   ISP는 일반적으로 자신의 네트워크를 원하는 대로 운용하거나(e.g., 어떠한 라우팅 알고리즘이라도 수행할 수 있도록),  
   네트워크 내부 구성을 외부에 감추기를 원한다.

<br/>

### 자율 시스템

위의 문제점들은 라우터들을 `자율 시스템(autonomous system, AS)`으로 조직화하여 해결할 수 있다.

- 각 AS는 동일한 관리 제어하에 있는 라우터의 그룹으로 구성된다.
- 자율 시스템은 전 세계적으로 고유한 `AS 번호(autonomous system number, ASN)`으로 식별된다.
- 같은 AS 안에 있는 라우터들은 동일한 라우팅 알고리즘을 사용하고 상대방에 대한 정보를 갖고 있다.
- 자율 시스템 내부에서 동작하는 라우팅 알고리즘을 `AS 내부 라우팅 프로토콜(intra-autonomous system routing protocol)`이라고 한다.

<br/>
<br/>

## 개방형 최단 경로 우선(OSPF) 프로토콜

`개방형 최단 경로 우선(open shortest path first, OSPF) 라우팅`과 `IS-IS(Intermediate System to Intermediate System)`는  
인터넷에서 AS 내부 라우팅에 널리 사용된다.

<br/>

OSPF는 링크 상태 정보를 플러딩(flooding)하고 다익스트라 최소 비용 경로 알고리즘을 사용하는 **링크 상태 알고리즘**이다.

- OSPF를 이용하여 각 라우터는 <b>전체 AS에 대한 완벽한 토폴로지 지도(그래프)</b>를 얻는다.


- 각 라우터는 자신을 루트 노드로 두고 모든 서브넷에 이르는 최단 경로 트리를 결정하기 위해 혼자서 다익스트라의 최단 경로 알고리즘을 수행한다.


- OSPF를 사용하는 라우터는 **자율 시스템 내의 다른 모든 라우터에게** 라우팅 정보를 브로드캐스팅한다.
    - 링크 상태가 변경될 때마다
    - 링크 상태가 변경되지 않았더라도 정기적으로(최소한 30분마다 한 번씩)


- OSPF 메시지에 포함된 상태 정보는 인터넷 프로토콜에 의해 전달되며, 상위 계층 프로토콜 번호로는 OSPF를 의미하는 `89`를 갖는다.
    - 따라서 OSPF 프로토콜은 신뢰할 수 있는 메시지 전송과 링크 상태의 브로드캐스트와 같은 기능을 스스로 구현해야 한다.
    - 또한 OSPF 프로토콜은 링크가 동작하고 있는지 검사하고,  
      OSPF 라우터가 네트워크 전반의 링크 상태에 대한 이웃 라우터의 데이터베이스를 얻을 수 있도록 해야 한다.

<br/>

### OSPF 링크 가중치 설정

링크 상태 라우팅을 설명하면서 우리는 순서를 묵시적으로 아래와 같이 가정했다.

1. 링크 가중치가 설정되고,
2. OSPF 같은 라우팅 알고리즘이 수행되며,
3. LS 알고리즘에 의해 계산된 라우팅 테이블의 내용에 따라 트래픽이 흐른다.

<br/>

이를 원인과 결과 방식으로 설명하면,

- 원인 : 링크 가중치가 주어지고
- 결과 : 이에 따라 전체 비용을 최소화하는 라우팅 경로가 결정된다.

<br/>

실제로는 링크 가중치와 라우팅 경로 간의 원인과 결과 관계는 반대가 될 수도 있다.

네트워크 운영자가 어떤 트래픽 관리 목표를 충족시키는 라우팅 경로를 얻기 위해 링크 가중치를 설정할 수 있다.

즉, 트래픽 흐름에 대한 바람직한 경로가 알려져 있고, OSPF 라우팅 알고리즘이 이 경로대로 구성하게 되도록 OSPF 링크 가중치를 찾아야 한다.

<br/>

따라서 관리자는 모든 링크 비용을 1로 설정함으로써 최소 홉 라우팅이 이루어지게 하거나,  
적은 대역폭을 가진 링크 사용을 억제하기 위해 링크 용량에 반비례하게 링크 가중치를 설정할 수 있다.

<br/>

### OSFP에 구현된 개선사항들

#### 보안

OSPF 라우터들 간의 정보 교환(e.g., 링크 상태 갱신)을 인증할 수 있으며,  
인증을 통해 신뢰할 수 있는 라우터들만이 AS 내부의 OSPF 프로토콜에 참여할 수 있다.

원래 라우터 간의 OSPF 패킷은 인증을 하지 않으므로 위조될 수 있다.

<br/>

두 종류의 인증

- 단순 인증 : 동일한 패스워드가 각 라우터에 설정되며, 라우터가 OSPF 패킷을 보낼 때 패스워드를 평문 그대로 포함하기 때문에 안전하지 않다.
- MD5 인증 : 모든 라우터에 설정된 공유 비밀키를 기반으로 한다. *(8장 내용)*

<br/>

#### 복수 동일 비용 경로

하나의 목적지에 대해 동일한 비용을 가진 여러 개의 경로가 존재할 때 OSPF는 여러 개의 경로를 사용할 수 있도록 한다.

즉, 비용이 동일한 여러 개의 경로가 있을 때 **모든 트래픽을 전달하기 위한 단 하나의 경로를 선택할 필요가 없다.**

<br/>

#### 유니캐스트와 멀티캐스트 라우팅의 통합 지원

`MOSPF(multicast OSPF)`는 멀티캐스트 라우팅 기능을 제공하기 위해 OSPF를 단순 확장했다.

- 기존의 OSPF 링크 데이터베이스를 사용
- OSPF 링크 상태 브로드캐스트 메커니즘에 새로운 형태의 링크 상태 알림을 추가

<br/>

[참고]

- `MAC 주소` : 네트워크 상에서 서로를 구분하기 위해 디바이스마다 할당된 물리적 주소
- `유니캐스트(Unicast)` : 정보를 전송하기 위한 프레임에 자신의 MAC 주소와 목적지의 MAC 주소를 첨부하여 전송하는 방식  (일대일 통신)
- `브로드캐스트(Broadcast)` : 로컬 네트워크에 연결되어 있는 모든 시스템에게 프레임을 보내는 방식  
  (송신 노드 하나가 네트워크에 연결된 수신 가능한 모든 노드에 데이터를 전송)
- `멀티캐스트(Multicast)` : 네트워크에 연결되어 있는 시스템 중 특정 그룹을 지정해서 해당 그룹원에게만 한 번에 정보를 전송하는 방식  
  (라우터가 멀티캐스트를 지원해야만 사용 가능)

<br/>

#### 단일 AS 내에서의 계층 지원

OSPF의 자율 시스템(AS)는 계층적인 영역(area)으로 구성될 수 있다.

- 각 영역은 자신의 OSPF 링크 상태 라우팅 알고리즘을 수행한다.
- 한 역역 내의 라우터는 **같은 영역 내의 라우터들에게만** 링크 상태를 브로드캐스트한다.
- 각 영역 내에서 하나 혹은 그 이상의 `영역 경계 라우터(area border router)`가 **영역 외부로의 패킷 라우팅을 책임진다.**
- `백본 영역`의 주요 역할은 AS 내 영역 간의 트래픽을 라우팅하는 것이다.

<br/>

AS 내 영역 간 라우팅을 위해서는,

1. 영역 경계 라우터로 패킷을 라우팅한다. (영역 내 라우팅)
2. 백본을 통과하여 목적지 영역의 영역 경계 라우터로 라우팅한다.
3. 그 후 최종 목적지로 라우팅한다.
