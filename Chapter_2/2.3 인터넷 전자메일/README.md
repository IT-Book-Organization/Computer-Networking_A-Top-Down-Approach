# 2.3 μΈν„°λ„· μ „μλ©”μΌ

μ΄ μ μ—μ„λ” μΈν„°λ„· μ „μλ©”μΌ κµ¬μ΅°μ μ¤‘μ‹¬μ— μλ” μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµ ν”„λ΅ν† μ½μ„ μ•μ•„λ³Έλ‹¤.

<br/>

μ•„λ κ·Έλ¦Όμ€ μΈν„°λ„· λ©”μΌ μ‹μ¤ν…μ μƒμ„ λ λ²¨ κ°λ…μ„ λ³΄μ—¬μ¤€λ‹¤.

<p align="center"><img width="600" alt="μ „μ λ©”μΌ μ‹μ¤ν…" src="https://user-images.githubusercontent.com/76640167/210542924-1107ca75-eee8-45f6-829a-df0d0df81c15.png">

<br/>
<br/>

Three major components of Electronic mail:

- `User agents`
- `Mail servers`
- `SMTP(Simple Mail Transfer Protocol)`

<br/>
<br/>

## μ‚¬μ©μ μ—μ΄μ „νΈ(User Agent, UA)

- a.k.a. "mail reader"
- μ‚¬μ©μ μ—μ΄μ „νΈλ” μ‚¬μ©μκ°€ λ©”μ‹μ§€λ¥Ό μ½κ³ , μ‘λ‹µν•κ³ , μ „λ‹¬ν•κ³ , μ €μ¥ν•κ³ , κµ¬μ„±ν•κ² ν•΄μ¤€λ‹¤.
- λ€ν‘μ μΌλ΅ λ§μ΄ν¬λ΅ μ†ν”„νΈ μ•„μ›ƒλ£©(Outlook), μ• ν” λ©”μΌ λ“±μ΄ μλ‹¤.

<br/>
<br/>

## λ©”μΌ μ„λ²„(mail server)

- μ „μ λ©”μΌ μΈν”„λΌμ¤νΈλ­μ²μ μ¤‘μ‹¬μ΄λ‹¤.
- κ° μμ‹ μλ” λ©”μΌ μ„λ²„μ— `λ©”μΌ λ°•μ¤(mailbox)`λ¥Ό κ°–κ³  μλ‹¤.
    - λ©”μΌ λ°•μ¤λ” μμ‹ μμ λ©”μ‹μ§€λ¥Ό μ μ§€ν•κ³  κ΄€λ¦¬ν•λ‹¤.
    - **μΌλ° λ©”μ‹μ§€λ” μ†΅μ‹ μμ μ‚¬μ©μ μ—μ΄μ „νΈμ—μ„ μ „λ‹¬μ΄ μ‹μ‘λκ³ , μ†΅μ‹ μμ λ©”μΌ μ„λ²„λ¥Ό κ±°μΉ ν›„μ— μμ‹ μμ λ©”μΌ μ„λ²„λ΅ μ „λ‹¬λλ‹¤.**  
      κ±°κΈ°μ„ μμ‹ μμ λ©”μΌ λ°•μ¤μ— μ €μ¥λλ‹¤.
    - μ „μλ©”μΌ λ°•μ¤μ— μλ” λ©”μ‹μ§€λ¥Ό λ³΄λ ¤λ©΄ λ©”μΌ μ„λ²„λ” μ‚¬μ©μ κ³„μ •κ³Ό λΉ„λ°€ λ²νΈλ¥Ό μ΄μ©ν•μ—¬ μ΄μ©μλ¥Ό μΈμ¦ν•μ—¬μ•Ό ν•λ‹¤.
- μ†΅μ‹ μλ” λ©”μΌ μ„λ²„μ κ³ μ¥μ—λ„ λ€μ²ν•΄μ•Ό ν•λ‹¤.
    - λ§μ•½ λ©”μΌμ„ μμ‹ μμ λ©”μΌ μ„λ²„λ΅ μ „λ‹¬ν•  μ μ—†λ‹¤λ©΄ κ·Έ λ©”μ‹μ§€λ¥Ό `λ©”μ‹μ§€ ν(queue)`μ— λ³΄κ΄€ν•κ³  λ‚μ¤‘μ— κ·Έ λ©”μ‹μ§€λ¥Ό μ „λ‹¬ν•κΈ° μ„ν•΄ λ‹¤μ‹ μ‹λ„ν•λ‹¤.
    - μ¬μ‹λ„λ” μ•½ 30λ¶„λ§λ‹¤ μΌμ–΄λ‚κ³ , κ³„μ† μ‹¤ν¨ μ‹μ— μ„λ²„λ” κ·Έ λ©”μ‹μ§€λ¥Ό μ κ±°ν•κ³  μ†΅μ‹ μμ—κ² ν†µλ³΄ν•λ‹¤.

<br/>
<br/>

## SMTP

> π’΅ μΈν„°λ„· μ „μλ©”μΌμ„ μ„ν• μ£Όμ” μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµ ν”„λ΅ν† μ½μ΄λ‹¤.

- SMTPλ” λ©”μΌμ„ μ†΅μ‹ μμ λ©”μΌ μ„λ²„λ΅λ¶€ν„° μμ‹ μμ λ©”μΌ μ„λ²„λ΅ μ „μ†΅ν•λ” λ°μ— `TCPμ μ‹ λΆ°μ μΈ λ°μ΄ν„° μ „μ†΅ μ„λΉ„μ¤`λ¥Ό μ΄μ©ν•λ‹¤.
- SMTPλ” λ€λ¶€λ¶„μ μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµ ν”„λ΅ν† μ½μ²λΌ, `ν΄λΌμ΄μ–ΈνΈ`μ™€ `μ„λ²„`λ¥Ό κ°–κ³  μλ‹¤.
- SMTPμ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘κ°€ λ¨λ“  λ©”μΌ μ„λ²„μ—μ„ μν–‰λκ³ , μƒλ€ λ©”μΌλ΅ μ†΅μ‹ ν•  λ•λ” ν΄λΌμ΄μ–ΈνΈκ°€ λκ³  μμ‹ ν•  λ•λ” μ„λ²„κ°€ λλ‹¤.

<br/>
<br/>
<br/>

# 2.3.1 SMTP

> uses `TCP` **to reliably transfer email message** from client to server, `port 25`

> `direct transfer`: sending server to receiving server

<br/>

SMTPμ—μ„λ” λ¨λ“  λ©”μΌ λ©”μ‹μ§€μ λΈμ²΄λ” λ‹¨μν• `7-bit ASCII`μ—¬μ•Ό ν•λ‹¤.

μ΄ λ•λ¬Έμ— μ „μ†΅ μ©λ‰μ΄ μ ν•λμ–΄ μ»¤λ‹¤λ€ μ²¨λ¶€ νμΌμ΄λ‚ λΉ„λ””μ¤ νμΌμ„ λ³΄λ‚Ό λ• λ¬Έμ λ¥Ό μΌμΌν‚¨λ‹¤.

<br/>

Three phases of transfer

1. handshaking (greeting)
2. transfer of messages (data exchange)
3. closure

<br/>

### κΈ°λ³Έ λ™μ‘ κ³Όμ •

<p align="center"><img width="700" alt="λ©”μ‹μ§€ μ „λ‹¬ κ³Όμ •" src="https://user-images.githubusercontent.com/76640167/210545342-e280b01b-fff0-4ec7-b921-9bfcddb94999.png">

<br/>
<br/>

1. μ•¨λ¦¬μ¤λ” `μ „μ λ©”μΌ μ‚¬μ©μ μ—μ΄μ „νΈ`λ¥Ό μν–‰ν•κ³ , λ°¥μ μ „μ λ©”μΌ μ£Όμ†λ¥Ό μ κ³µν•μ—¬ λ©”μ‹μ§€λ¥Ό λ³΄λ‚΄λΌκ³  λ…λ Ήν•λ‹¤.


2. μ•¨λ¦¬μ¤μ μ‚¬μ©μ μ—μ΄μ „νΈλ” λ©”μ‹μ§€λ¥Ό κ·Έλ…€μ `λ©”μΌ μ„λ²„`μ—κ² λ³΄λ‚΄κ³ , κ·Έκ³³μ—μ„ λ©”μ‹μ§€λ” `λ©”μ‹μ§€ ν`μ— λ†“μΈλ‹¤.


3. μ•¨λ¦¬μ¤μ λ©”μΌ μ„λ²„μ—μ„ λ™μ‘ν•λ” SMTPμ ν΄λΌμ΄μ–ΈνΈ μΈ΅μ€ λ©”μ‹μ§€ νμ— μλ” λ©”μ‹μ§€λ¥Ό λ³Έλ‹¤.  
   **λ°¥μ λ©”μΌ μ„λ²„μ—μ„ μν–‰λκ³  μλ” SMTP μ„λ²„μ—κ² `TCP μ—°κ²°`μ„ μ„¤μ •ν•λ‹¤.**


4. μ΄κΈ° SMTP ν•Έλ“μ…°μ΄ν‚Ή μ΄ν›„μ— SMTP ν΄λΌμ΄μ–ΈνΈλ” μ•¨λ¦¬μ¤μ λ©”μ‹μ§€λ¥Ό TCP μ—°κ²°λ΅ λ³΄λ‚Έλ‹¤.


5. λ°¥μ λ©”μΌ μ„λ²„ νΈμ¤νΈμ—μ„ SMTPμ μ„λ²„ μΈ΅μ€ λ©”μ‹μ§€λ¥Ό μμ‹ ν•λ‹¤. λ°¥μ `λ©”μΌ μ„λ²„`λ” κ·Έ λ©”μ‹μ§€λ¥Ό λ°¥μ `λ©”μΌ λ°•μ¤`μ— λ†“λ”λ‹¤.


6. λ°¥μ€ νΈν• μ‹κ°„μ— κ·Έ λ©”μ‹μ§€λ¥Ό μ½κΈ° μ„ν•΄ `μ‚¬μ©μ μ—μ΄μ „νΈ`λ¥Ό μ‹λ™ν•λ‹¤.

<br/>

> SMTPλ” λ‘ λ©”μΌ μ„λ²„κ°€ λ¨Ό κ±°λ¦¬μ— λ–¨μ–΄μ Έ μλ”λΌλ„ **μ¤‘κ°„ λ©”μΌ μ„λ²„λ¥Ό μ΄μ©ν•μ§€ μ•λ”λ‹¤.**

μ¦‰, λ©”μ‹μ§€λ¥Ό λ³΄λ‚Ό λ• λ³΄λ‚΄λ”λ° μ‹¤ν¨ν•λ”λΌλ„ μ¤‘κ°„ λ©”μΌ μ„λ²„μ— μ €μ¥λλ” κ²ƒμ΄ μ•„λ‹λΌ **μ†΅μ‹ μμ λ©”μΌ μ„λ²„μ— λ‚¨μ•„μλ‹¤.**

<br/>
<br/>

### κΈ°λ³Έ λ™μ‘ κ³Όμ • Detail

1. ν΄λΌμ΄μ–ΈνΈ SMTPλ” μ„λ²„μ SMTPμ `25λ² ν¬νΈ`λ΅ `TCP μ—°κ²°`μ„ μ„¤μ •ν•λ‹¤. μ„λ²„κ°€ μ£½μ–΄μλ‹¤λ©΄ λ‚μ¤‘μ— μ‹λ„ν•λ‹¤.


2. μ—°κ²°μ΄ μ„¤μ •λλ©΄, `μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµ ν•Έλ“μ…°μ΄ν‚Ή`μ„ μν–‰ν•λ‹¤.  
   μ΄λ• SMTP ν΄λΌμ΄μ–ΈνΈλ” μ†΅μ‹ μμ μ „μλ©”μΌ μ£Όμ†μ™€ μμ‹ μμ μ „μλ©”μΌ μ£Όμ†λ¥Ό μ κ³µν•λ‹¤.


3. μ΄ν›„ ν΄λΌμ΄μ–ΈνΈλ” λ©”μ‹μ§€λ¥Ό λ³΄λ‚Έλ‹¤. (TCPμ μ‹ λΆ°μ μΈ λ°μ΄ν„° μ „μ†΅ μ„λΉ„μ¤μ— μμ΅΄)


4. **λ³΄λ‚Ό λ‹¤λ¥Έ λ©”μ‹μ§€κ°€ μλ‹¤λ©΄ κ°™μ€ TCP μ—°κ²° μƒμ—μ„ λ°λ³µν•λ©°**, κ·Έλ ‡μ§€ μ•μΌλ©΄ TCPλ¥Ό λ‹«λ”λ‹¤. (`μ§€μ† μ—°κ²°(persistent connection)`)

<br/>
<br/>

## SMTP ν΄λΌμ΄μ–ΈνΈ(C)μ™€ SMTP μ„λ²„(S) μ‚¬μ΄μ λ©”μ‹μ§€ μ „λ‹¬ κ³Όμ • μμ‹

```
S:  220 hamburger.edu
C:  HELO crepes.fr
S:  250 Hello crepes.fr, pleased to meet you
C:  MAIL FROM: <alice@crepes.fr>
S:  250 alice@crepes.fr ... Sender ok
C:  RCPT TO: <bob@hamburger.edu>
S:  250 bob@hamburger.edu ... Recipient ok
C:  DATA
S:  354 Enter mail, end with β€.β€ on a line by itself
C:  Do you like ketchup?
C:  How about pickles?
C:  .
S:  250 Message accepted for delivery
C:  QUIT
S:  221 hamburger.edu closing connection
```

<br/>

<p align="center"><img width="830" alt="λ©”μ‹μ§€ μ „λ‹¬ κ³Όμ • μμ‹" src="https://user-images.githubusercontent.com/86337233/232236656-a28366f7-e268-4cd4-a525-86b39c658069.png">

<br/>
<br/>

- ν΄λΌμ΄μ–ΈνΈλ” 5κ°μ `HELO`, `MAIL FROM`, `RCPT TO`, `DATA`, `QUIT` λ…λ Ήμ„ λ‚΄λ¦°λ‹¤.
- ν΄λΌμ΄μ–ΈνΈλ” ν•λ‚μ μ (`.`)μΌλ΅ λ λΌμΈμ„ μ†΅μ‹ ν•λ©°, κ·Έκ²ƒμ€ **μ„λ²„μ—μ„ λ©”μ‹μ§€μ λμ„ λ‚νƒ€λ‚Έλ‹¤.**
- μ„λ²„λ” κ° λ…λ Ήμ— μ‘λ‹µν•λ©°, κ° μ‘λ‹µμ—λ” μ‘λ‹µ μ½”λ“μ™€ μλ¬Έ μ„¤λ…μ΄ μλ‹¤.

<br/>

**SMTPλ” `μ§€μ† μ—°κ²°(persistent connection)`μ„ μ‚¬μ©ν•λ‹¤.**

μ¦‰, κ°™μ€ μμ‹  λ©”μΌ μ„λ²„λ΅ λ³΄λ‚΄λ” μ—¬λ¬ λ©”μ‹μ§€λ¥Ό κ°–κ³  μλ‹¤λ©΄, **κ°™μ€ TCP μ—°κ²°μ„ ν†µν•΄ λ¨λ“  λ©”μ‹μ§€λ¥Ό μ „λ‹¬ν•  μ μλ‹¤.**

<br/>

telnet λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•λ©΄ μ›κ²© λ©”μΌ μ„λ²„μ™€ μ„μ™€ κ°™μ€ λ€ν™”λ¥Ό ν•  μ μλ‹¤.

<br/>
<br/>
<br/>

# 2.3.2 λ©”μΌ λ©”μ‹μ§€ ν¬λ§·

μ „μλ©”μΌμ„ λ³΄λ‚Ό λ• μ£Όλ³€ μ •λ³΄κ°€ ν¬ν•¨λ `ν—¤λ”(header)`κ°€ `λ©”μ‹μ§€ λΈμ²΄(body)` μ•μ— μ¤κ² λλ‹¤.

- μ΄ ν—¤λ”λ” RFC 5322μ— μ •μλμ–΄ μμΌλ©°, ν—¤λ”μ™€ λΈμ²΄λ” CRLFλ΅ λ¶„λ¦¬λλ‹¤.
- λ¨λ“  ν—¤λ”λ” `From:` ν—¤λ”λΌμΈκ³Ό `To:` ν—¤λ” λΌμΈμ„ λ°λ“μ‹ κ°€μ Έμ•Ό ν•λ‹¤. (λ‚λ¨Έμ§€ ν—¤λ”λ” μ„ νƒμ‚¬ν•­μ΄λ‹¤.)

<br/>

<p align="center"><img width="600" alt="λ©”μ‹μ§€ ν¬λ§·" src="https://user-images.githubusercontent.com/86337233/232237089-44b78dca-e43b-458c-9de0-f2756195c8a1.png">

<br/>
<br/>

μΌλ° λ©”μ‹μ§€ ν—¤λ”λ” λ‹¤μκ³Ό κ°™λ‹¤.

```
From: alice@crepes.fr
To: bob@hamburger.edu
Subject: Searching for the meaning of life.

Message
```

<br/>
<br/>
<br/>

# 2.3.3 λ©”μΌ μ ‘μ† ν”„λ΅ν† μ½(Mail access protocols)

- `SMTP` : delivery / storage to receiver's server
- `Mail access protocol` : retrieval from server

<br/>

> `λ©”μΌ μ„λ²„`κ°€ λ©”μΌ λ°•μ¤λ¥Ό κ΄€λ¦¬ν•κ³ , SMTPμ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ μΈ΅ λ¨λ‘λ¥Ό μν–‰ν•λ‹¤.

<br/>

λ©”μΌ μ„λ²„κ°€ λ΅μ»¬ νΈμ¤νΈμ— μλ‹¤λ©΄, νΈμ¤νΈλ” μ–Έμ λ“  λ„μ°©ν•  μ μλ” μ „μ λ©”μΌμ„ μμ‹ ν•κΈ° μ„ν•΄ ν•­μƒ μΌμ Έ μμ–΄μ•Ό ν•κ³  μΈν„°λ„·μ— μ—°κ²°λμ–΄ μμ–΄μ•Ό ν•λ‹¤.

μ΄λ” λ€λ¶€λ¶„μ μΈν„°λ„· μ‚¬μ©μμ—κ²λ” λΉ„ν„μ‹¤μ μ΄λ‹¤.

<br/>

λ€μ‹ μ— μΌλ° μ‚¬μ©μλ” λ΅μ»¬ νΈμ¤νΈμ—μ„ μ‚¬μ©μ μ—μ΄μ „νΈλ¥Ό μν–‰ν•κ³  **λ μΌμ Έ μλ” κ³µμ  λ©”μΌ μ„λ²„μ— μ €μ¥λ λ©”μΌλ°•μ¤μ— μ ‘κ·Όν•λ‹¤.**

λ©”μΌ μ„λ²„λ” λ³΄ν†µ μ‚¬μ©μλ“¤κ³Ό κ³µμ ν•λ‹¤.

<br/>

<p align="center"><img width="770" alt="μ „μλ©”μΌ ν”„λ΅ν† μ½" src="https://user-images.githubusercontent.com/76640167/210550668-901b362b-a929-4d44-abe8-da7bf21ca857.png">

<br/>
<br/>

### μ†΅μ‹ μ μ‚¬μ©μ μ—μ΄μ „νΈμ—μ„ μμ‹ μ λ©”μΌ μ„λ²„κΉμ§€

> ν΄λΌμ΄μ–ΈνΈμ μ‚¬μ©μ μ—μ΄μ „νΈλ” μμ‹ μμ λ©”μΌ μ„λ²„λ΅ μ§μ ‘ λ€ν™”ν•μ§€ μ•λ”λ‹¤.

λ€μ‹ μ— κ·Έλ¦Όμ²λΌ (1) ν΄λΌμ΄μ–ΈνΈμ μ‚¬μ©μ μ—μ΄μ „νΈλ” **ν΄λΌμ΄μ–ΈνΈμ λ©”μΌ μ„λ²„λ΅ μ „μλ©”μΌ λ©”μ‹μ§€λ¥Ό `SMTP` λλ” `HTTP`λ¥Ό μ΄μ©ν•μ—¬ λ³΄λ‚Έλ‹¤.**

(2) κ·Έλ¦¬κ³  μμ‹ μμ λ©”μΌ μ„λ²„λ” **`SMTP`λ¥Ό μ΄μ©ν•μ—¬ μμ‹ μμ λ©”μΌ μ„λ²„λ΅ μ „μλ©”μΌ λ©”μ‹μ§€λ¥Ό μ¤‘κ³„ν•λ‹¤.**

<br/>

λ‘ λ‹¨κ³„ μ μ°¨λ¥Ό κ±°μΉλ” μ£Όμ” μ΄μ λ” μμ‹ μμ λ©”μΌ μ„λ²„λ¥Ό ν†µν•΄ μ¤‘κ³„ν•μ§€ μ•μΌλ©΄ μμ‹ μμ μ—μ΄μ „νΈλ” λ©μ μ§€ λ©”μΌ μ„λ²„μ— λ„λ‹¬ν•  μ μ—†κΈ° λ•λ¬Έμ΄λ‹¤.

μ†΅μ‹ μλ” μ „μλ©”μΌμ„ μμ‹ μ λ©”μΌ μ„λ²„μ— λ¨Όμ € μ €μ¥ν•κ³ , μμ‹ μμ λ©”μΌ μ„λ²„λ” κ·Έ λ©”μ‹μ§€λ¥Ό μμ‹ μμ λ©”μΌ μ„λ²„λ΅ λ°›μ„ λ•κΉμ§€ 30λ¶„ λ§λ‹¤ λ°λ³µν•΄μ„ λ³΄λ‚΄λ ¤κ³  ν•λ‹¤.

<br/>

### μμ‹ μ λ©”μΌ μ„λ²„μ—μ„ μμ‹ μ μ‚¬μ©μ μ—μ΄μ „νΈκΉμ§€

μμ‹ μλ” μμ‹ μ ISP λ‚΄λ¶€μ λ©”μΌ μ„λ²„μ— λ©”μ‹μ§€λ¥Ό μ–΄λ–»κ² μ–»μ„ μ μλ”κ°€?

SMTPλ” `push` ν”„λ΅ν† μ½μΈ λ°λ©΄ λ©”μ‹μ§€λ¥Ό μ–»λ” κ²ƒμ€ `pull` λ™μ‘μ΄κΈ° λ•λ¬Έμ— λ‹¤λ¥Έ ν”„λ΅ν† μ½μ„ μ‚¬μ©ν•μ—¬μ•Ό ν•λ‹¤.

<br/>

λ‘ κ°€μ§€ λ€ν‘μ μΈ λ°©λ²•

- `HTTP`
    - μ›Ή κΈ°λ° μ „μλ©”μΌμ΄λ‚ μ¤λ§νΈν° μ•±μ κ²½μ°μ— μ“°μΈλ‹¤.
    - λ‹Ήμ—°ν λ©”μΌ μ„λ²„λ” SMTP μΈν„°νμ΄μ¤μ™€ HTTP μΈν„°νμ΄μ¤ λ‘ λ‹¤ κ°€μ§€κ³  μμ–΄μ•Ό ν•λ‹¤.
- `IMAP` : RFC 3501μ— μ •μλ μΈν„°λ„· λ©”μΌ μ ‘κ·Ό ν”„λ΅ν† μ½
